## 📘 UserManual.md - 打印机中间件用户手册

### 🖥️ 软件简介

这是一个运行在 Windows 系统的打印机中间件程序，提供 WebSocket 接口，通过局域网接收打印任务，自动选择指定本地打印机进行静默打印。

---

### 🧰 功能一览

| 功能           | 描述                      |
| ------------ | ----------------------- |
| WebSocket 接收 | 支持客户端通过 WebSocket 推送任务  |
| 自动下载 PDF     | 自动下载请求中的文件链接            |
| 静默打印         | 无需弹窗，自动选择打印机打印          |
| 多打印机支持       | 支持命名为 `#1`、`#2` 等编号的打印机 |
| 托盘常驻         | 关闭窗口自动最小化到托盘            |
| 开机自启         | 可选项，开机自动启动程序            |
| 日志记录         | 自动记录任务及错误信息，保留近 14 天    |
| 客户端监控        | 实时显示连接中的客户端 IP          |
| 多网卡支持        | 显示所有可连接的 WebSocket 地址   |

---

### 🛠️ 使用前准备

1. **打印机命名要求：**
   打印机必须以 `#1`、`#2`、`#3` 等开头命名（通过系统设置更改名称）
   例如：`#1 HP LaserJet 1020`

2. **安装 SumatraPDF（推荐）：**
   用于静默打印 PDF
   下载地址：[https://www.sumatrapdfreader.org/](https://www.sumatrapdfreader.org/)
   将 `SumatraPDF.exe` 放在程序所在目录

---

### ⚙️ 初次配置

1. 启动程序，打开主界面
2. 设置监听端口（默认：5888）
3. 勾选是否开机自启
4. 查看打印机列表（仅显示命名合规的打印机）
5. 点击“保存设置”以应用配置
6. 查看程序显示的 WebSocket 地址，如：

```
ws://192.168.1.100:5888
ws://192.168.1.101:5888
```

---

### 📡 WebSocket 任务格式（客户端发送）

```json
{
  "files": [
    { "printer_id": 1, "url": "https://example.com/doc1.pdf" },
    { "printer_id": 2, "url": "https://example.com/doc2.pdf" }
  ]
}
```

> 每个对象包含打印机编号 + 文件链接
> 支持多个任务同时提交

---

### 📦 托盘功能说明

| 动作        | 效果      |
| --------- | ------- |
| 关闭主窗口     | 最小化到托盘  |
| 托盘右键 → 打开 | 重新显示主界面 |
| 托盘右键 → 退出 | 完全退出程序  |

---

### 📑 日志功能

* 日志文件保存路径：`/Logs/`
* 每日一个文件：如 `log_2025-09-28.log`
* 自动保留近 14 天日志
* 主界面可实时查看日志

---

### 🌐 已连接客户端

主界面右侧实时显示已连接的客户端 IP
支持多客户端同时连接推送任务

---

### 🧪 测试用 JavaScript 示例

```html
<script>
const ws = new WebSocket("ws://192.168.1.100:5888");
ws.onopen = () => {
  const msg = {
    files: [
      { printer_id: 1, url: "https://example.com/test.pdf" }
    ]
  };
  ws.send(JSON.stringify(msg));
};
</script>
```

---

### 🛑 注意事项

* 仅支持 **PDF 文件打印**
* 打印完的文件会自动删除，不留本地残留
* 请确保打印机在线且处于就绪状态
* 请勿将中间件暴露在公网，限局域网使用

---

### ❓ 常见问题

| 问题       | 解答                 |
| -------- | ------------------ |
| 打印机不显示？  | 检查打印机名称是否以 `#` 开头  |
| 打印无响应？   | 检查 SumatraPDF 是否存在 |
| 客户端连接失败？ | 检查防火墙、端口是否开启       |
| 文件未打印成功？ | 查看日志中是否有错误信息       |

---

### 🧼 卸载方法

1. 退出程序
2. 删除程序目录及配置文件（如 `config.json`、`Logs` 文件夹）
3. 可手动移除注册表中的开机启动项（可选）

---

如有更多问题，请联系程序开发者或管理员。



